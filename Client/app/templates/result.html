<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
  <link rel="stylesheet" href="{{url_for('static', filename='index.css') }}">
  <title>Shoogle</title>
</head>
<body>

  <div>
  
    <form action="/result" method="GET">
      <div id="search-bar" class="mx-auto mt-5 search-bar input-group">
        <input name="search" type="text" class="form-control rounded-pill" placeholder="이미지 입력 또는 키워드 검색" aria-label="Recipient's username" aria-describedby="button-addon2">
        <div class="input-group-append">
        </div>
      </div>
    </form>

    <form action = "http://3.34.50.182:5050/image" method = "POST" enctype = "multipart/form-data">
      <div id="image-search-bar" class="mx-auto search-bar input-group" style="margin:1rem;">
        <input type = "file" name = "file" style="width: 450px;"/>
        <input type = "submit"/>
      </div>
    </form>

  </div>

  <!-- Gallery -->
  <div id="gallery" style="margin:0 auto; width: auto;">
    <script type="text/javascript">

      // HTML Form-data 받아오기 - 검색 키워드
      var search = window.location.search.substring(1);
      var apiUrl = 'http://3.34.50.182:5050/items?' + search;
      // var apiUrl = 'http://0.0.0.0:5050/items?' + search;

      fetch(apiUrl).then(response => {
        return response.json();
      }).then(data => {
        var result = '';
        items = data['data'];
        
        for(var i = 0; i<items.length; ++i){
          result += '<a href="' + items[i].item_url + '"><img class="thumbnail" src="' + items[i].image_url + '" loading="lazy"/> </a>';
        }

        var gallery = document.getElementById("gallery");
        gallery.innerHTML = result;

      }).catch(err => {

      });
    </script>
  </div>
  <!-- Gallery -->

</body>
</html>

